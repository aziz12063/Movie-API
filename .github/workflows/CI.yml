name: Run ReSharper CI

on:
  push:
    branches:
      - CiBranche
  pull_request:
    branches:
      - CiBranche

jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    
   # - name: Setup .NET
    #  uses: actions/setup-dotnet@v1
     # with:
      #  dotnet-version: '6.0.x'  # Set your desired .NET version

   # - name: Restore dependencies
    #  run: dotnet restore

    - name: Download ReSharper Command Line Tools
      run: |      
        $url = "https://download.jetbrains.com/resharper/dotUltimate.2023.1/JetBrains.ReSharper.CommandLineTools.2023.1.zip"
        $output = "ReSharperCLT.zip"        
        Invoke-WebRequest -Uri $url -OutFile $output      
        Expand-Archive $output -DestinationPath .\ReSharperCLT
       
     
    - name: Run ReSharper inspections
      run: .\resharperclt\inspectcode.exe ApiApplication.sln --output=resharper-results.xml

      
    - name: Upload ReSharper results
      uses: actions/upload-artifact@v2
      with:
        name: resharper-results
        path: resharper-results.xml

    - name: Read ReSharper results
      run: cat resharper-results.xml

    - name: Save ReSharper results to repository
      run: |
        mkdir -p results
        dir
        cp resharper-results.xml results/
        dir results/
        git config --local user.email "aziz12063@gmail.com"
        git config --local user.name "aziz12063"
        git add results/resharper-results.xml
        git commit -m "Add ReSharper results"

    - name: Update ReSharper results
      run: |
        echo "Result 2" > results/resharper-results.xml
        git config --local user.email "aziz12063@gmail.com"
        git config --local user.name "aziz12063"
        git add results/resharper-results.xml
        git commit -m "Update Result to 2"


    

         

  
